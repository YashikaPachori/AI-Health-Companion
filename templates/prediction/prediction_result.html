{% extends 'base.html' %}
{% load static %}

{% block title %}Your Latest Prediction Result{% endblock %}

{% block content %}
<div class="container" style="margin-top: 2.5rem; margin-bottom: 3rem;">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 220px;">
                <h1 style="margin-bottom: .5rem;">üìÑ Your Latest Prediction Result</h1>
                <p style="color: var(--light-text); margin-bottom: .5rem;">Predicted on {{ prediction.created_at|date:"M d, Y" }}</p>
            </div>
            <div style="text-align: right; min-width: 200px;">
                <a href="{% url 'prediction:check_symptoms' %}" class="btn btn-outline" style="margin-right: .5rem;">‚Üê Check Symptoms Again</a>
                <a href="{% url 'prediction:disease_detail' disease.name %}" class="btn btn-primary">üìò Know more about {{ disease.name }}</a>
            </div>
        </div>

        <hr style="margin: 1.25rem 0; border: none; border-top: 1px solid var(--border-color);">

        <div class="result-box" style="margin-bottom: 2rem;">
            <h2 style="margin-bottom: 1rem;">Predicted Disease: <span style="color: var(--accent-color); font-size: 1.2em;">{{ disease.name }}</span></h2>
            <div style="margin: 1rem 0;">
                <strong>Confidence Score:</strong>
                <div class="confidence-bar" style="margin-top: 0.5rem;">
                    <div class="confidence-fill" style="width: {{ prediction.confidence_score }}%;">
                        {{ prediction.confidence_score }}%
                    </div>
                </div>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                <p><strong>Severity:</strong> <span class="badge badge-{{ disease.severity_level }}">{{ disease.severity_level|upper }}</span></p>
                <p><strong>Recommended Specialist:</strong> <span style="color: var(--primary-color); font-weight: 600;">{{ disease.specialist_required }}</span></p>
            </div>
        </div>

        <div style="margin-top: 2rem;">
            <h3 style="margin-bottom: 1rem;">üìã Recommendations</h3>
            {% if recommendations.precautions and recommendations.precautions|length > 0 %}
                <h4 style="margin-top: 1rem;">Precautions</h4>
                <ul style="color: var(--light-text);">
                    {% for p in recommendations.precautions %}
                        <li>{{ p }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% if recommendations.diet.recommended or recommendations.diet.avoid %}
                <h4 style="margin-top: 1rem;">Diet</h4>
                {% if recommendations.diet.recommended %}
                    <p><strong style="color: var(--success-color);">Eat:</strong></p>
                    <ul style="color: var(--light-text);">
                        {% for item in recommendations.diet.recommended %}
                            <li>{{ item.food_item }} ‚Äî {{ item.description }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                {% if recommendations.diet.avoid %}
                    <p><strong style="color: var(--danger-color);">Avoid:</strong></p>
                    <ul style="color: var(--light-text);">
                        {% for item in recommendations.diet.avoid %}
                            <li>{{ item.food_item }} ‚Äî {{ item.description }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endif %}
        </div>

        <div style="margin-top: 2rem; padding: 1rem; background: #f0f9ff; border-radius: 8px; border-left: 4px solid var(--primary-color);">
            <a href="{% url 'prediction:disease_detail' disease.name %}" class="btn btn-primary">üìò Full information: what {{ disease.name }} is & how to prevent</a>
        </div>

        {% if doctors and doctors|length > 0 %}
        <div style="margin-top: 2rem;">
            <h4>Recommended Doctors</h4>
            <ul style="color: var(--light-text);">
                {% for d in doctors %}
                    <li><strong>{{ d.user.get_full_name }}</strong> ‚Äî {{ d.specialization }}</li>
                {% endfor %}
            </ul>
            <a href="{% url 'consultation:doctor_list' %}?specialization={{ disease.specialist_required|urlencode }}" class="btn btn-primary" style="margin-top: 1rem;">Find {{ disease.specialist_required }}s</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
